#!/usr/bin/env node

require('coffee-script');
require('colors');

var argv = require('optimist').argv,
    commands = require('../lib/commands');

// get command

var cmd = commands[argv._.splice(0,1)];
if (!cmd) return commands.help()

// execute command

if (cmd.sync) {
  res = cmd({ pretty: true });
  if (res.error) return console.error("ERROR: ".red + res.error)
  console.log(res)
} else {
  var cmd = cmd.apply(null, argv._.concat([opts_only(argv), cb]));
}

function cb(err, res){
  if (err){
    console.error("ERROR: ".red + err)
    process.exit(64) // command line usage error
  }
  console.log(res)
}

function opts_only(args){
  var clone = JSON.parse(JSON.stringify(args))
  delete clone._
  delete clone['$0']
  if (Object.keys(clone).length < 1) { return undefined }
  return clone
}
